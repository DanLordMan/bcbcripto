{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USUARIO\\\\Desktop\\\\Proyecto Coin\\\\30-DApp con React - Loter\\xEDa con Tokens ERC-20 y ERC-721\\\\src\\\\components\\\\Loteria.js\";\nimport React, { Component } from 'react';\nimport smart_contract from '../abis/loteria.json';\nimport Web3 from 'web3';\nimport Swal from 'sweetalert2';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport Navigation from './Navbar';\nimport MyCarousel from './Carousel';\nimport { Container } from 'react-bootstrap';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Loteria extends Component {\n  async componentDidMount() {\n    // 1. Carga de Web3\n    await this.loadWeb3(); // 2. Carga de datos de la Blockchain\n\n    await this.loadBlockchainData();\n  } // 1. Carga de Web3\n\n\n  async loadWeb3() {\n    if (window.ethereum) {\n      window.web3 = new Web3(window.ethereum);\n      const accounts = await window.ethereum.request({\n        method: 'eth_requestAccounts'\n      });\n      console.log('Accounts: ', accounts);\n    } else if (window.web3) {\n      window.web3 = new Web3(window.web3.currentProvider);\n    } else {\n      window.alert('¡Deberías considerar usar Metamask!');\n    }\n  } // 2. Carga de datos de la Blockchain\n\n\n  async loadBlockchainData() {\n    const web3 = window.web3;\n    const accounts = await web3.eth.getAccounts();\n    this.setState({\n      account: accounts[0]\n    }); // Ganache -> 5777, Rinkeby -> 4, BSC -> 97\n\n    const networkId = await web3.eth.net.getId();\n    console.log('networkid:', networkId);\n    const networkData = smart_contract.networks[networkId];\n    console.log('NetworkData:', networkData);\n\n    if (networkData) {\n      const abi = smart_contract.abi;\n      console.log('abi', abi);\n      const address = networkData.address;\n      console.log('address:', address);\n      const contract = new web3.eth.Contract(abi, address);\n      this.setState({\n        contract\n      });\n    } else {\n      window.alert('¡El Smart Contract no se ha desplegado en la red!');\n    }\n  }\n\n  constructor(props) {\n    super(props);\n\n    this._compraBoletos = async _numBoletos => {\n      try {\n        console.log(\"Compra de boletos de loteria en ejecucion...\");\n        await this.state.contract.methods.compraBoleto(_numBoletos).send({\n          from: this.state.account\n        });\n        Swal.fire({\n          icon: 'success',\n          title: 'Compra de boletos completada, ¡mucha suerte!',\n          width: 800,\n          padding: '3em',\n          text: `Has comprado ${_numBoletos} boletos`,\n          backdrop: `\n              rgba(15, 238, 168, 0.2)\n              left top\n              no-repeat\n            `\n        });\n      } catch (err) {\n        this.setState({\n          errorMessage: err\n        });\n      } finally {\n        this.setState({\n          loading: false\n        });\n      }\n    };\n\n    this._precioBoleto = async () => {\n      try {\n        console.log(\"Precio del boleto en ejecucion...\");\n\n        const _precio = await this.state.contract.methods.precioBoleto().call();\n\n        Swal.fire({\n          icon: 'info',\n          title: `El precio del boleto es de ${_precio} tokens (ERC-20)`,\n          width: 800,\n          padding: '3em',\n          backdrop: `\n              rgba(15, 238, 168, 0.2)\n              left top\n              no-repeat\n            `\n        });\n      } catch (err) {\n        this.setState({\n          errorMessage: err\n        });\n      } finally {\n        this.setState({\n          loading: false\n        });\n      }\n    };\n\n    this._tusBoletos = async () => {\n      try {\n        console.log(\"Visualizacion de tus boletos en ejecucion...\");\n\n        const _boletos = await this.state.contract.methods.tusBoletos(this.state.account).call();\n\n        Swal.fire({\n          icon: 'info',\n          title: `Tus boletos son:`,\n          width: 800,\n          text: `${_boletos}`,\n          padding: '3em',\n          backdrop: `\n              rgba(15, 238, 168, 0.2)\n              left top\n              no-repeat\n            `\n        });\n      } catch (err) {\n        this.setState({\n          errorMessage: err\n        });\n      } finally {\n        this.setState({\n          loading: false\n        });\n      }\n    };\n\n    this.state = {\n      account: '0x0',\n      loading: true,\n      contract: null,\n      errorMessage: \"\"\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(Navigation, {\n        account: this.state.account\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(MyCarousel, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"container-fluid mt-5\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: /*#__PURE__*/_jsxDEV(\"main\", {\n            role: \"main\",\n            className: \"col-lg-12 d-flex text-center\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"content mr-auto ml-auto\",\n              children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n                children: \" Gesti\\xF3n de la Loter\\xEDa con ERC-20 y ERC-721 \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 151,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n                children: \" Compra de boletos \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 152,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n                onSubmit: event => {\n                  event.preventDefault();\n                  const cantidad = this._numBoletos.value;\n\n                  this._compraBoletos(cantidad);\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"number\",\n                  className: \"form-control mb-1\",\n                  placeholder: \"Cantidad de boletos a comprar\",\n                  ref: input => this._numBoletos = input\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 158,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"submit\",\n                  className: \"bbtn btn-block btn-primary btn-sm\",\n                  value: \"COMPRAR BOLETOS\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 163,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 153,\n                columnNumber: 33\n              }, this), \"\\xA0\", /*#__PURE__*/_jsxDEV(Container, {\n                children: /*#__PURE__*/_jsxDEV(Row, {\n                  children: [/*#__PURE__*/_jsxDEV(Col, {\n                    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                      children: \" Precio Boleto \"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 171,\n                      columnNumber: 45\n                    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n                      onSubmit: event => {\n                        event.preventDefault();\n\n                        this._precioBoleto();\n                      },\n                      children: /*#__PURE__*/_jsxDEV(\"input\", {\n                        type: \"submit\",\n                        className: \"bbtn btn-block btn-danger btn-sm\",\n                        value: \"PRECIO BOLETO\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 176,\n                        columnNumber: 49\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 172,\n                      columnNumber: 45\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 170,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(Col, {\n                    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                      children: \" Tus Boletos \"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 182,\n                      columnNumber: 45\n                    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n                      onSubmit: event => {\n                        event.preventDefault();\n\n                        this._tusBoletos();\n                      },\n                      children: /*#__PURE__*/_jsxDEV(\"input\", {\n                        type: \"submit\",\n                        className: \"bbtn btn-block btn-success btn-sm\",\n                        value: \"TUS BOLETOS\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 187,\n                        columnNumber: 49\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 183,\n                      columnNumber: 45\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 181,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 169,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 168,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 150,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 149,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Loteria;","map":{"version":3,"sources":["C:/Users/USUARIO/Desktop/Proyecto Coin/30-DApp con React - Lotería con Tokens ERC-20 y ERC-721/src/components/Loteria.js"],"names":["React","Component","smart_contract","Web3","Swal","Row","Col","Navigation","MyCarousel","Container","Loteria","componentDidMount","loadWeb3","loadBlockchainData","window","ethereum","web3","accounts","request","method","console","log","currentProvider","alert","eth","getAccounts","setState","account","networkId","net","getId","networkData","networks","abi","address","contract","Contract","constructor","props","_compraBoletos","_numBoletos","state","methods","compraBoleto","send","from","fire","icon","title","width","padding","text","backdrop","err","errorMessage","loading","_precioBoleto","_precio","precioBoleto","call","_tusBoletos","_boletos","tusBoletos","render","event","preventDefault","cantidad","value","input"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport smart_contract from '../abis/loteria.json';\nimport Web3 from 'web3';\nimport Swal from 'sweetalert2';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\n\nimport Navigation from './Navbar';\nimport MyCarousel from './Carousel';\nimport { Container } from 'react-bootstrap';\n\nclass Loteria extends Component {\n\n    async componentDidMount() {\n        // 1. Carga de Web3\n        await this.loadWeb3()\n        // 2. Carga de datos de la Blockchain\n        await this.loadBlockchainData()\n    }\n\n    // 1. Carga de Web3\n    async loadWeb3() {\n        if (window.ethereum) {\n            window.web3 = new Web3(window.ethereum)\n            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });\n            console.log('Accounts: ', accounts)\n        }\n        else if (window.web3) {\n            window.web3 = new Web3(window.web3.currentProvider)\n        }\n        else {\n            window.alert('¡Deberías considerar usar Metamask!')\n        }\n    }\n\n    // 2. Carga de datos de la Blockchain\n    async loadBlockchainData() {\n        const web3 = window.web3\n        const accounts = await web3.eth.getAccounts()\n        this.setState({ account: accounts[0] })\n        // Ganache -> 5777, Rinkeby -> 4, BSC -> 97\n        const networkId = await web3.eth.net.getId()\n        console.log('networkid:', networkId)\n        const networkData = smart_contract.networks[networkId]\n        console.log('NetworkData:', networkData)\n\n        if (networkData) {\n            const abi = smart_contract.abi\n            console.log('abi', abi)\n            const address = networkData.address\n            console.log('address:', address)\n            const contract = new web3.eth.Contract(abi, address)\n            this.setState({ contract })\n        } else {\n            window.alert('¡El Smart Contract no se ha desplegado en la red!')\n        }\n    }\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            account: '0x0',\n            loading: true,\n            contract: null,\n            errorMessage: \"\"\n        }\n    }\n\n    _compraBoletos = async (_numBoletos) => {\n        try {\n            console.log(\"Compra de boletos de loteria en ejecucion...\")\n            await this.state.contract.methods.compraBoleto(_numBoletos).send({\n                from: this.state.account\n            })\n            Swal.fire({\n                icon: 'success',\n                title: 'Compra de boletos completada, ¡mucha suerte!',\n                width: 800,\n                padding: '3em',\n                text: `Has comprado ${_numBoletos} boletos`,\n                backdrop: `\n              rgba(15, 238, 168, 0.2)\n              left top\n              no-repeat\n            `\n            })\n        } catch (err) {\n            this.setState({ errorMessage: err })\n        } finally {\n            this.setState({ loading: false })\n        }\n    }\n\n    _precioBoleto = async () => {\n        try {\n            console.log(\"Precio del boleto en ejecucion...\")\n            const _precio = await this.state.contract.methods.precioBoleto().call()\n            Swal.fire({\n                icon: 'info',\n                title: `El precio del boleto es de ${_precio} tokens (ERC-20)`,\n                width: 800,\n                padding: '3em',\n                backdrop: `\n              rgba(15, 238, 168, 0.2)\n              left top\n              no-repeat\n            `\n            })\n        } catch (err) {\n            this.setState({ errorMessage: err })\n        } finally {\n            this.setState({ loading: false })\n        }\n    }\n\n    _tusBoletos = async () => {\n        try {\n            console.log(\"Visualizacion de tus boletos en ejecucion...\")\n            const _boletos = await this.state.contract.methods.tusBoletos(\n                this.state.account\n            ).call()\n            Swal.fire({\n                icon: 'info',\n                title: `Tus boletos son:`,\n                width: 800,\n                text: `${_boletos}`,\n                padding: '3em',\n                backdrop: `\n              rgba(15, 238, 168, 0.2)\n              left top\n              no-repeat\n            `\n            })\n\n        } catch (err) {\n            this.setState({ errorMessage: err })\n        } finally {\n            this.setState({ loading: false })\n        }\n    }\n\n    render() {\n        return (\n            <div>\n                <Navigation account={this.state.account} />\n                <MyCarousel />\n                <div className=\"container-fluid mt-5\">\n                    <div className=\"row\">\n                        <main role=\"main\" className=\"col-lg-12 d-flex text-center\">\n                            <div className=\"content mr-auto ml-auto\">\n                                <h1> Gestión de la Lotería con ERC-20 y ERC-721 </h1>\n                                <h3> Compra de boletos </h3>\n                                <form onSubmit={(event) => {\n                                    event.preventDefault()\n                                    const cantidad = this._numBoletos.value\n                                    this._compraBoletos(cantidad)\n                                }} >\n                                    <input type=\"number\"\n                                        className=\"form-control mb-1\"\n                                        placeholder=\"Cantidad de boletos a comprar\"\n                                        ref={(input) => this._numBoletos = input} />\n\n                                    <input type=\"submit\"\n                                        className=\"bbtn btn-block btn-primary btn-sm\"\n                                        value=\"COMPRAR BOLETOS\" />\n                                </form>\n                                &nbsp;\n                                <Container>\n                                    <Row>\n                                        <Col>\n                                            <h3> Precio Boleto </h3>\n                                            <form onSubmit={(event) => {\n                                                event.preventDefault()\n                                                this._precioBoleto()\n                                            }}>\n                                                <input type=\"submit\"\n                                                    className=\"bbtn btn-block btn-danger btn-sm\"\n                                                    value=\"PRECIO BOLETO\" />\n                                            </form>\n                                        </Col>\n                                        <Col>\n                                            <h3> Tus Boletos </h3>\n                                            <form onSubmit={(event) => {\n                                                event.preventDefault()\n                                                this._tusBoletos()\n                                            }}>\n                                                <input type=\"submit\"\n                                                    className=\"bbtn btn-block btn-success btn-sm\"\n                                                    value=\"TUS BOLETOS\" />\n                                            </form>\n                                        </Col>\n                                    </Row>\n                                </Container>\n                            </div>\n                        </main>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default Loteria;\n"]},"metadata":{},"sourceType":"module"}